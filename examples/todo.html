<!DOCTYPE html>
<html>
  <head>
    <title>My Todo List</title>
    <script src="../vendor/jquery.js" type="text/javascript"></script>
    <script src="../vendor/underscore-min.js" type="text/javascript"></script>
    <script src="../lib/glue.js" type="text/javascript"></script>
    <script src="../lib/glue/objectController.js" type="text/javascript"></script>
    <script src="../lib/glue/arrayController.js" type="text/javascript"></script>
    <script>
      $(function(){
        var tasksController   = new ArrayController()
        ,   $taskCountElement = $("#toDoCount")
        ,   $taskListElement  = $("#toDoList")
        ,   $toDoForm         = $("#toDoForm")
        ;

        tasksController.addObserver($taskCountElement, function(msg){
          this.html(msg.currentCount+ " tasks");
        });

        $toDoForm.submit( function(evt){
          evt.preventDefault();

          // Start simulating an Ajax call.
          var data = $(this).serialize().split("=");
          var taskData = {};
          taskData[data[0]] = data[1].replace(/\+/gi," ");
          taskData["done"] = false;
          // End simulation- taskData is now a 'json' obj

          var task = new ObjectController(taskData);
          var $tsk = $("<div><input type='checkbox'>"+task.get('task')+"</div>")
            .bind("change", function(e){
              task.set("done", $(this).find("input").is(":checked") );
            })
          ;

          task.addObserver($tsk, "done", function(msg){
            this.css({ "text-decoration": (!!(msg.newValue) ? "line-through" : "none") });
          });

          $taskListElement.append($tsk);
          tasksController.add(task);

          $toDoForm.find("input").first().val("").focus();
        });

        //bootstrap UX.
        $toDoForm.find("input").first().focus();
      });
    </script>
  </head>
  <body>
    <fieldset>
      <legend>Add new task</legend>
      <form id="toDoForm">
          <input type="text" name="task" placeholder="Add new task here.">
          <input type="submit" value="Add">
      </form>
    </fieldset>
    <fieldset>
      <legend id="toDoCount">0 tasks</legend>
      <div id="toDoList"> </div>
    </fieldset>
  </body>
</html>
